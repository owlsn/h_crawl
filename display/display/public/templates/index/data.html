{% extends '../common/aside.html' %}
{% block css %}
<link rel="stylesheet" href="{{ static_url('dist/css/skins/_all-skins.min.css') }}">
{% end %}
{% block content %}
<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>
      Data Tables
      <small>advanced tables</small>
    </h1>
    <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li><a href="#">Tables</a></li>
      <li class="active">Data tables</li>
    </ol>
  </section>

  <!-- Main content -->
  <section class="content">
    <div class="row">
      <div class="col-xs-12">
        <!-- /.box -->

        <div class="box">
          <div class="box-header">
            <h3 class="box-title">Data Table With Full Features</h3>
          </div>
          <!-- /.box-header -->
          <div class="box-body">
            <table id="list" class="table table-bordered table-striped">
              <thead>
                <th>ip</th>
                <th>端口</th>
                <th>类型</th>
                <th>等级</th>
                <th>是否获取地址信息</th>
                <th>过期次数</th>
                <th>捕获时间</th>
                <th>检测时间</th>
              </thead>
              <tbody>
                
              </tbody>
            </table>
          </div>
          <!-- /.box-body -->
        </div>
        <!-- /.box -->
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  </section>
  <!-- /.content -->
</div>
{% end %}
<!-- ./wrapper -->

{% block js %}
<!-- DataTables -->
<script src="{{ static_url('bower_components/datatables.net/js/jquery.dataTables.min.js') }}"></script>
<script src="{{ static_url('bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js') }}"></script>
<!-- SlimScroll -->
<script src="{{ static_url('bower_components/jquery-slimscroll/jquery.slimscroll.min.js') }}"></script>
<!-- FastClick -->
<script src="{{ static_url('bower_components/fastclick/lib/fastclick.js') }}"></script>
<!-- AdminLTE App -->
<script src="{{ static_url('dist/js/adminlte.min.js') }}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{{ static_url('dist/js/demo.js') }}"></script>
<!-- page script -->
<script>
  $(function () {
    $('#list').DataTable({
      autoWidth: false,  //禁用自动调整列宽
      stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
      processing: true,  //隐藏加载提示,自行处理
      serverSide: true,  //启用服务器端分页
      searching: false,  //禁用原生搜索
      orderMulti: false,  //启用多列排序
      order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
      renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
      pagingType: "simple_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
      columnDefs: [{
          "targets": 'nosort',  //列的样式名
          "orderable": false    //包含上样式名‘nosort’的禁止排序
      }],
      paging: true,
      lengthChange: true,
      ordering: true,
      info: true,
      destroy : true,
      columns: [
          { "data": "ip" },
          { "data": "port" },
          { "data": "scheme" },
          { "data": "level" },
          { "data": "flag" },
          { "data": "times" },
          { "data": "create_time" },
          { "data": "update_time" },
      ],
      ajax : function (data, callback, settings) {
          //封装请求参数
          var param = {};
          param.limit = data.length;//页面显示记录条数，在页面显示每页显示多少项的时候
          param.start = data.start;//开始的记录序号
          param.page = (data.start / data.length)+1;//当前页码
          //ajax请求数据
          $.ajax({
              type : 'post',
              url : '/list',
              //data : {href : condition[href]}
              data: param,  //传入组装的参数
              dataType: "json",
              success: function (result) {
                  //console.log(result);
                  //setTimeout仅为测试延迟效果
                  setTimeout(function () {
                      //封装返回数据
                      var returnData = {};
                      returnData.draw = data.draw;//这里直接自行返回了draw计数器,应该由后台返回
                      returnData.recordsTotal = result.total;//返回数据全部记录
                      returnData.recordsFiltered = result.total;//后台不实现过滤功能，每次查询均视作全部结果
                      returnData.data = result.data;//返回的数据列表
                      //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                      //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                      callback(returnData);
                  }, 200);
              }
          });
      }
    })
  })
</script>
{% end %}
